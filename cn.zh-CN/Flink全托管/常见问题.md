---
keyword: [公网, 访问, OSSException, undefined]
---

# 常见问题

本文汇总了Flink全托管常见问题与解决方案，包括作业开发问题、作业运维问题、网络相关问题和异常情况处理问题。

-   作业开发问题
    -   [如何在OSS控制台上传JAR包？](#section_n50_cdr_610)
    -   [如何为SQL作业配置Rocksdb Statebackend？](#section_hsq_3mv_ebg)
    -   [报错：undefined](#section_4ue_qt3_mk1)
    -   [报错：Object '\*\*\*\*' not found](#section_afx_xbz_ztk)
    -   [报错：Only a single 'INSERT INTO' is supported](#section_pay_6fz_jk7)
-   作业运维问题
    -   [如何查找引发告警的作业？](#section_cji_n5d_vu7)
    -   [如何查看工作空间ID等信息？](#section_39s_s0f_psa)
    -   [Python作业，如果Checkpoint慢怎么办？](#section_zga_zxt_01g)
    -   [报错：OSSException](#section_y7f_jj0_czt)
    -   [报错：exceeded quota: resourcequota](#section_a84_588_2z2)
    -   [报错：Exceeded checkpoint tolerable failure threshold](#section_ccg_u9w_7cn)
    -   [INFO：org.apache.flink.fs.osshadoop.shaded.com.aliyun.oss](#section_oi6_jz0_td1)
-   网络相关问题
    -   [Flink全托管集群如何访问公网？](#section_vvx_0qb_o7d)
    -   [如何访问跨VPC里的存储资源？](#section_uaq_oes_stp)
-   异常情况处理问题
    -   [如何解决Flink依赖冲突问题？](#section_tiq_eb4_sqz)
    -   [如何解析Flink作业所依赖服务的域名？](#section_k1k_0q4_kzg)
    -   [JobManager没有运行起来，如何快速定位问题？](#section_xr7_5g6_x7p)
    -   [不小心删除了角色或者变更了授权策略，导致Flink全托管服务不可用怎么办？](#section_2ph_vmw_pwl)

## 如何在OSS控制台上传JAR包？

1.  在Flink全托管控制台上查看当前集群的OSS Bucket。

    ![OSS Bucket](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6908031161/p186374.png)

    OSS Bucket信息如下图所示。

    ![Bucket详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6908031161/p230660.png)

2.  登录[OSS管理控制台](https://oss.console.aliyun.com/)，上传JAR包至目标Bucket的/artifats/namespaces目录下。

    ![jar目录](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9906276061/p186522.png)

3.  在Flink全托管控制台左侧导航栏，单击**资源上传**，查看通过OSS控制台上传的JAR包。

    ![查看jar包](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0016276061/p186527.png)


## 如何为SQL作业配置Rocksdb Statebackend？

在目标作业详情页面右上角，单击**编辑**后，在**其他配置**中，添加如下两行代码后保存生效。

```
state.backend: rocksdb 
state.backend.incremental: true
```

![详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5616525061/p182189.png)

## 报错：undefined

-   报错详情

    ![报错信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8043449951/p141940.png)

-   报错原因

    您的JAR包较大。

-   解决方案

    您可以在[OSS管理控制台](https://oss.console.aliyun.com/)上传JAR包，详情请参见[如何在OSS控制台上传JAR包？](#section_n50_cdr_610)


## 报错：Object '\*\*\*\*' not found

-   报错详情

    单击**运行**后，验证报错详情如下。

    ![报错详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6419898161/p266344.png)

-   报错原因

    在DDL和DML同在一个文本中提交运行时，DDL没有声明为CREATE TEMPORARY TABLE。

-   解决方案

    在DDL和DML同在一个文本中提交运行时，DDL需要声明为CREATE TEMPORARY TABLE，而不是声明为CREATE TABLE。


## 报错：Only a single 'INSERT INTO' is supported

-   报错详情

    单击**运行**后，验证报错详情如下。

    ![报错详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6419898161/p266356.png)

-   报错原因

    多个DML语句没有写在关键语句`BEGIN STATEMENT SET;`和`END;`之间。

-   解决方案

    将多个DML语句写在`BEGIN STATEMENT SET;`和`END;`之间。详情请参见[INSERT INTO语句](/cn.zh-CN/Flink全托管/Flink SQL参考/DML语句/INSERT INTO语句.md)。


## 如何查找引发告警的作业？

告警事件中包含JobID和Deployment ID信息，但是由于作业Failover后导致JobID发生变化，因此您需要通过Deployment ID查找是哪个作业报错。目前，Flink全托管控制台上暂无Deployment ID信息，您需要在作业的URL中获取Deployment ID信息。

![Deployment ID](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5908031161/p180106.png)

## 如何查看工作空间ID等信息？

在管理控制台目标工作空间名称右侧，选择**其他** \> **工作空间详情**。

![工作空间详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6908031161/p183281.png)

## Python作业，如果Checkpoint慢怎么办？

-   问题原因

    Python算子内部有一定的缓存，在进行Checkpoint时，需要将缓存中的数据全部处理完。因此，如果Python UDF的性能较差，则会导致Checkpoint时间变长，从而影响作业执行。

-   解决方案

    在作业开发页面，单击右侧的**高级配置**后，在**更多Flink配置**项中，设置以下参数，将缓存调小。

    ```
    python.fn-execution.bundle.size：默认值为100000，单位是条数。
    python.fn-execution.bundle.time：默认值为1000，单位是毫秒。
    ```

    参数的详细信息请参见[Flink Python配置](https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/python/python_config.html)。


## 报错：OSSException

-   报错详情

    新作业启动或已上线作业重启时报错。

    ![报错](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8043449951/p147396.png)

-   报错原因

    对象存储OSS开启了版本控制，导致存在大量的Object。

-   解决方案
    1.  在[OSS管理控制台](https://oss.console.aliyun.com/)，关闭版本控制，详情请参见[版本控制](/cn.zh-CN/控制台用户指南/存储空间管理/冗余与容错/版本控制.md)。
    2.  将oss://\{bucket\}/flink-jobs/namespaces/\{namespace\}/jobs/下的Object全部删除。

        ```
        ./ossutil64 rm oss://{bucket}/flink-jobs/namespaces/{namespace}/jobs/ --all-versions -r
        ```

        **说明：**

        -   本文以[ossutil](/cn.zh-CN/常用工具/命令行工具ossutil/概述.md)工具为例，您也可以使用其他方式删除Object。
        -   命令详情参见[rm（删除）](/cn.zh-CN/常用工具/命令行工具ossutil/常用命令/rm（删除）.md)。
    3.  重启Flink全托管作业。

## 报错：exceeded quota: resourcequota

-   报错详情

    作业启动过程中报错。

    ![报错](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6672094061/p180066.png)

-   报错原因

    当前项目空间资源不足导致作业启动失败。

-   解决方案

    您需要对项目资源进行资源变配，详情请参见[单项目资源变配](/cn.zh-CN/Flink全托管/项目管理.md)。


## 报错：Exceeded checkpoint tolerable failure threshold

-   报错详情

    作业运行过程中报错。

    ![详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7685741261/p275538.png)

-   报错原因

    未设置任务允许Checkpoint失败的次数，系统默认Checkpoint失败一次就触发一次Failover。

-   解决方案
    1.  在作业开发页面右侧，单击**高级配置**。
    2.  在**更多Flink配置**文本框，输入如下参数。

        ```
        execution.checkpointing.tolerable-failed-checkpoints: num
        ```

        您需要设置num值来调整任务允许Checkpoint失败的次数。num需要为0或正整数。如果num为0时，则表示不允许存在任何Checkpoint异常或者失败。


## INFO：org.apache.flink.fs.osshadoop.shaded.com.aliyun.oss

-   报错详情

    ![报错详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6210707161/p258496.png)

-   报错原因

    OSS每次创建新目录时，会先检查是否存在该目录，如果不存在，就会报这个INFO信息，但该INFO信息不影响Flink作业运行。

-   解决方案

    在日志模板中添加`<Logger level="ERROR" name="org.apache.flink.fs.osshadoop.shaded.com.aliyun.oss"/>`。详情请参见[配置作业日志](/cn.zh-CN/Flink全托管/运维管理/配置作业日志.md)。


## Flink全托管集群如何访问公网？

-   背景说明

    Flink全托管集群默认不具备访问公网的能力，但阿里云提供的NAT网关可以实现VPC网络与公网网络互通，以满足部分Flink全托管集群用户通过UDX或Datastream代码访问公网的需求。

    ![背景说明](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5952749951/p86093.png)

-   解决方案

    通过在VPC中创建NAT网关，并创建SNAT条目，将Flink全托管集群所在的交换机绑定至弹性公网IP（EIP），即可通过EIP访问公网。具体配置方法请参见：

    1.  创建NAT网关，详情请参见[创建NAT网关](/cn.zh-CN/购买指南/购买NAT网关.md)。
    2.  创建SNAT条目，详情请参见[创建SNAT条目](/cn.zh-CN/基本功能操作/创建SNAT实现访问公网服务.md)。
    3.  将Flink全托管集群所在的交换机绑定至弹性公网IP（EIP），详情请参见[绑定EIP](/cn.zh-CN/基本功能操作/创建NAT网关实例.md)。

## 如何访问跨VPC里的存储资源？

您可以通过以下几种方式跨VPC访问存储资源：

-   [提交工单](https://selfservice.console.aliyun.com/ticket/createIndex?accounttraceid=f7b76db740fa486baa4b63bd5848fbc1idrb)，产品名称选择**VPC**，要求通过**高速通道**或其它产品建立网络连接，但是此种方式需要付费。
-   使用VPN网关建立VPC到VPC的VPN连接，详情请参见[建立VPC到VPC的连接](/cn.zh-CN/最佳实践/建立VPC到VPC的连接.md)。
-   退掉和Flink全托管不同VPC的存储服务后，重新购买一个与Flink全托管相同VPC的存储服务。
-   释放Flink全托管服务后，重新购买一个和存储服务相同VPC的Flink全托管服务。
-   开通Flink全托管的公网访问能力，通过公网访问存储服务。Flink全托管集群默认不具备访问公网的能力，如有需求，详情请参见[\#section\_8j0\_s5r\_5s5](#section_8j0_s5r_5s5)。

    **说明：** 因为在延迟性方面，公网不如内网，如果您对性能有要求，建议不要使用此方式。


## 如何解决Flink依赖冲突问题？

-   问题现象
    -   有明显报错，且引发错误的为Flink或Hadoop相关类。

        ```
        java.lang.AbstractMethodError
        java.lang.ClassNotFoundException
        java.lang.IllegalAccessError
        java.lang.IllegalAccessException
        java.lang.InstantiationError
        java.lang.InstantiationException
        java.lang.InvocationTargetException
        java.lang.NoClassDefFoundError
        java.lang.NoSuchFieldError
        java.lang.NoSuchFieldException
        java.lang.NoSuchMethodError
        java.lang.NoSuchMethodException
        ```

    -   无明显报错，但会引起一些不符合预期的现象，例如：
        -   日志不输出或log4j配置不生效。

            该类问题通常是由于依赖中携带了log4j相关配置导致的。需要排查作业JAR包中是否引入了log4j配置的依赖，可以通过在dependency中配置exclusions的方式去掉log4j配置。

            **说明：** 如果必须要使用不同版本的log4j，需要使用maven-shade-plugin将log4j相关的class relocation掉。

        -   RPC调用异常。

            Flink的Akka RPC调用出现依赖冲突可能导致的异常，默认不会显示在日志中，需要开启Debug日志进行确认。

            例如，Debug日志中出现`Cannot allocate the requested resources. Trying to allocate ResourceProfile{xxx}`，但是JM日志在`Registering TaskManager with ResourceID xxx`后，没有下文，直到资源请求超时报错`NoResourceAvailableException`。此外TM持续报错`Cannot allocate the requested resources. Trying to allocate ResourceProfile{xxx}`。

            原因：开启Debug日志后，发现RPC调用报错`InvocationTargetException`，该报错导致TM Slot分配到一半失败出现状态不一致，RM持续尝试分配Slot失败无法恢复。

-   问题原因
    -   作业JAR包中包含了不必要的依赖（例如基本配置、Flink、Hadoop和log4j依赖），造成依赖冲突从而引发各种问题。
    -   作业需要的Connector对应的依赖未被打入JAR包中。
-   排查方法
    -   查看作业pom.xml文件，判断是否存在不必要的依赖。
    -   通过`jar tf foo.jar`命令查看作业JAR包内容，判断是否存在引发依赖冲突的内容。
    -   通过`mvn dependency:tree`命令查看作业的依赖关系，判断是否存在冲突的依赖。
-   解决方案
    -   基本配置建议将scope全部设置为provided，即不打入作业JAR包。
        -   DataStream Java

            ```
            <dependency>
              <groupId>org.apache.flink</groupId>
              <artifactId>flink-streaming-java_2.11</artifactId>
              <version>${flink.version}</version>
              <scope>provided</scope>
            </dependency>
            ```

        -   DataStream Scala

            ```
            <dependency>
              <groupId>org.apache.flink</groupId>
              <artifactId>flink-streaming-scala_2.11</artifactId>
              <version>${flink.version}</version>
              <scope>provided</scope>
            </dependency>
            ```

        -   DataSet Java

            ```
            <dependency>
              <groupId>org.apache.flink</groupId>
              <artifactId>flink-java</artifactId>
              <version>${flink.version}</version>
              <scope>provided</scope>
            </dependency>
            ```

        -   DataSet Scala

            ```
            <dependency>
              <groupId>org.apache.flink</groupId>
              <artifactId>flink-scala_2.11</artifactId>
              <version>${flink.version}</version>
              <scope>provided</scope>
            </dependency>
            ```

    -   添加作业需要的Connector对应的依赖，并将scope全部设置为compile（默认的scope是compile），即打入作业JAR包中，以Kafka Connector为例，代码如下。

        ```
        <dependency>
            <groupId>org.apache.flink</groupId>
            <artifactId>flink-connector-kafka_2.11</artifactId>
            <version>${flink.version}</version>
        </dependency>
        ```

    -   其他Flink、Hadoop和log4j依赖不建议添加。但是：
        -   如果作业本身存在基本配置或Connector相关的直接依赖，建议将scope设置为provided，示例如下。

            ```
            <dependency>
                <groupId>org.apache.hadoop</groupId>
                <artifactId>hadoop-common</artifactId>
                <scope>provided</scope>
            </dependency>
            ```

        -   如果作业存在基本配置或Connector相关的间接依赖，建议通过exclusion将依赖去掉，示例如下。

            ```
            <dependency>
                <groupId>foo</groupId>
                  <artifactId>bar</artifactId>
                  <exclusions>
                    <exclusion>
                    <groupId>org.apache.hadoop</groupId>
                    <artifactId>hadoop-common</artifactId>
                   </exclusion>
                </exclusions>
            </dependency>
            ```


## 如何解析Flink作业所依赖服务的域名？

如果您自建的Flink作业中所依赖的服务填写的是域名，则迁移上云至Flink全托管服务时，可能会报无法解析域名的问题。此时，您可以按照以下方案解析Flink作业所依赖服务的域名：

-   您已有自建的DNS，并且Flink VPC能够连通该自建DNS服务，且该自建DNS能够正常解析域名。

    此时，您可以基于Flink全托管作业模板进行域名解析。假如您的自建DNS IP为192.168.0.1，操作步骤如下：

    1.  登录[实时计算管理控制台](https://realtime-compute.console.aliyun.com/regions/cn-shanghai)。
    2.  在**Flink全托管**页签，单击目标工作空间**操作**列下的**控制台**。
    3.  在左侧导航栏，选择**系统管理** \> **作业模板**。
    4.  在**Flink配置**文本框，添加如下代码。

        ```
        env.java.opts: >-
          -Dsun.net.spi.nameservice.provider.1=default
          -Dsun.net.spi.nameservice.provider.2=dns,sun
          -Dsun.net.spi.nameservice.nameservers=192.168.0.1
        ```

        **说明：** 如果您的自建DNS有多个IP，建议IP之间使用英文逗号（,）分隔。

    5.  在Flink全托管控制台新建作业并运行。

        如果还报unknowhost错误，则意味着无法解析域名，请您[提交工单](https://selfservice.console.aliyun.com/ticket/createIndex?accounttraceid=f7b76db740fa486baa4b63bd5848fbc1idrb)进行咨询。

-   您没有自建的DNS或者Flink VPC无法与自建的DNS连通。

    此时，您需要基于阿里云云解析PrivateZone进行域名解析。假如您的Flink VPC为vpc-flinkxxxxxxx，Flink作业需要访问的服务的域名分别为aaa.test.com 127.0.0.1、bbb.test.com 127.0.0.2和ccc.test.com 127.0.0.3，操作步骤如下：

    1.  开通云解析PrivateZone。详情请参见[开通云解析PrivateZone](https://help.aliyun.com/document_detail/64627.html?spm=a2c4g.11186623.6.553.16ee82d2CHmY73)
    2.  添加Zone，以Flink作业需要访问服务的公共后缀作为Zone名称。详情请参见[添加Zone](https://help.aliyun.com/document_detail/64628.html?spm=a2c4g.11186623.6.554.552f653aT2zn3D)。
    3.  关联Flink全托管的VPC。详情请参见[关联/解关联VPC](https://help.aliyun.com/document_detail/64629.html?spm=a2c4g.11186623.6.555.6a293eefl8qHVa)
    4.  添加解析记录至Zone。详情请参见[添加PrivateZone解析记录](https://help.aliyun.com/document_detail/64635.html?spm=a2c4g.11186623.6.560.395b82d2p682dR)。

        ![结果](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1944772261/p280368.png)

    5.  在Flink全托管控制台新建作业并运行或者停止后再启动历史作业 。

        如果还报unknowhost错误，则意味着无法解析域名，请您[提交工单](https://selfservice.console.aliyun.com/ticket/createIndex?accounttraceid=f7b76db740fa486baa4b63bd5848fbc1idrb)进行咨询。


## JobManager没有运行起来，如何快速定位问题？

JobManager没有运行起来即无法进入**Flink UI**页面。此时，您可以通过以下操作进行问题定位：

1.  在**作业运维**页面，单击目标作业名称。
2.  单击**运行事件**页签。
3.  通过快捷键搜索error，获取异常信息。

    -   Windows系统：Ctrl+F
    -   Mac系统：Command+F
    ![示例](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8797630261/p269255.png)


## 不小心删除了角色或者变更了授权策略，导致Flink全托管服务不可用怎么办？

-   方式一

    如果您不小心删除了AliyunStreamAsiDefaultRole角色或者变更了授权策略导致Flink全托管服务不可用，请按照以下操作步骤重新授权。

    1.  创建角色。
        1.  登录RAM控制台。
            -   云账号登录[RAM控制台](https://ram.console.aliyun.com/)。
            -   RAM用户登录[RAM控制台](https://signin.aliyun.com/login.htm)。
        2.  在页面左侧导航栏，单击**RAM角色管理**。
        3.  单击**创建RAM角色**，并填写角色信息。

            **说明：** 角色名称为AliyunStreamAsiDefaultRole，如果AliyunStreamDefaultRole角色已存在，则不必重复创建该角色。

    2.  添加授权策略。

        1.  在RAM控制台左侧导航栏，单击**RAM角色管理**。
        2.  在**RAM角色名称**，找到AliyunStreamAsiDefaultRole角色。
        3.  单击**精确授权**。
        4.  权限类型选择为**自定义策略**。
        5.  在**输入策略名称**中，输入策略名称。

            需要为AliyunStreamAsiDefaultRole角色添加以下三个授权策略：

            -   策略一：自定义策略（AliyunStreamAsiDefaultRolePolicy0）

                ```
                {
                    "Version": "1",
                    "Statement": [
                        {
                            "Action": "oss:ListBuckets",
                            "Resource": "acs:oss:*:*:*",
                            "Effect": "Allow"
                        },
                        {
                            "Action": [
                                "ecs:AssociateEipAddress",
                                "ecs:AttachNetworkInterface",
                                "ecs:AuthorizeSecurityGroup",
                                "ecs:AuthorizeSecurityGroupEgress",
                                "ecs:CreateNetworkInterface",
                                "ecs:CreateNetworkInterfacePermission",
                                "ecs:CreateSecurityGroup",
                                "ecs:DeleteNetworkInterface",
                                "ecs:DeleteNetworkInterfacePermission",
                                "ecs:DeleteSecurityGroup",
                                "ecs:DescribeNetworkInterfacePermissions",
                                "ecs:DescribeNetworkInterfaces",
                                "ecs:DescribeSecurityGroupAttribute",
                                "ecs:DescribeSecurityGroupReferences",
                                "ecs:DescribeSecurityGroups",
                                "ecs:DetachNetworkInterface",
                                "ecs:JoinSecurityGroup",
                                "ecs:LeaveSecurityGroup",
                                "ecs:ModifyNetworkInterfaceAttribute",
                                "ecs:ModifySecurityGroupAttribute",
                                "ecs:ModifySecurityGroupPolicy",
                                "ecs:ModifySecurityGroupPolicy",
                                "ecs:ModifySecurityGroupRule",
                                "ecs:RevokeSecurityGroup",
                                "ecs:RevokeSecurityGroupEgress",
                                "ecs:UnassociateEipAddress"
                            ],
                            "Resource": "*",
                            "Effect": "Allow"
                        },
                        {
                            "Action": [
                                "arms:ListDashboards"
                            ],
                            "Resource": "*",
                            "Effect": "Allow"
                        },
                        {
                            "Action": [
                                "vpc:DescribeVpcAttribute",
                                "vpc:DescribeVpcs",
                                "vpc:DescribeVSwitchAttributes",
                                "vpc:DescribeVSwitches",
                                "vpc:DescribeRouteTableList",
                                "vpc:DescribeRouteTables",
                                "vpc:DescribeRouteEntryList",
                                "vpc:DescribeRouterInterfaceAttribute",
                                "vpc:DescribeRouterInterfaces",
                                "vpc:DescribeVRouters"
                            ],
                            "Resource": "*",
                            "Effect": "Allow"
                        }
                    ]
                }
                ```

            -   策略二：自定义策略（AliyunStreamAsiDefaultRolePolicy1）

                ```
                {
                    "Version": "1",
                    "Statement": [
                        {
                            "Action": [
                                "slb:AddBackendServers",
                                "slb:AddListenerWhiteListItem",
                                "slb:AddTags",
                                "slb:AddVServerGroupBackendServers",
                                "slb:CreateLoadBalancer",
                                "slb:CreateLoadBalancerHTTPListener",
                                "slb:CreateLoadBalancerHTTPSListener",
                                "slb:CreateLoadBalancerTCPListener",
                                "slb:CreateLoadBalancerUDPListener",
                                "slb:CreateRules",
                                "slb:CreateVServerGroup",
                                "slb:DeleteLoadBalancer",
                                "slb:DeleteLoadBalancerListener",
                                "slb:DeleteRules",
                                "slb:DeleteServerCertificate",
                                "slb:DeleteVServerGroup",
                                "slb:DescribeHealthStatus",
                                "slb:DescribeListenerAccessControlAttribute",
                                "slb:DescribeLoadBalancerAttribute",
                                "slb:DescribeLoadBalancerHTTPListenerAttribute",
                                "slb:DescribeLoadBalancerHTTPListenerAttributes",
                                "slb:DescribeLoadBalancerHTTPSListenerAttribute",
                                "slb:DescribeLoadBalancerTCPListenerAttribute",
                                "slb:DescribeLoadBalancerUDPListenerAttribute",
                                "slb:DescribeLoadBalancers",
                                "slb:DescribeRegions",
                                "slb:DescribeRules",
                                "slb:DescribeServerCertificates",
                                "slb:DescribeTags",
                                "slb:DescribeVServerGroupAttribute",
                                "slb:DescribeVServerGroups",
                                "slb:ModifyLoadBalancerInstanceSpec",
                                "slb:ModifyLoadBalancerInternetSpec",
                                "slb:ModifyLoadBalancerPayType",
                                "slb:RemoveBackendServers",
                                "slb:RemoveListenerWhiteListItem",
                                "slb:RemoveVServerGroupBackendServers",
                                "slb:SetBackendServers",
                                "slb:SetListenerAccessControlStatus",
                                "slb:SetLoadBalancerHTTPListenerAttribute",
                                "slb:SetLoadBalancerHTTPSListenerAttribute",
                                "slb:SetLoadBalancerName",
                                "slb:SetLoadBalancerStatus",
                                "slb:SetLoadBalancerTCPListenerAttribute",
                                "slb:SetLoadBalancerUDPListenerAttribute",
                                "slb:SetRule",
                                "slb:SetServerCertificateName",
                                "slb:SetVServerGroupAttribute",
                                "slb:StartLoadBalancerListener",
                                "slb:StopLoadBalancerListener",
                                "slb:UploadServerCertificate"
                            ],
                            "Resource": "*",
                            "Effect": "Allow"
                        }
                    ]
                }
                ```

            -   策略三：自定义策略（FlinkServerlessPolicy）

                ```
                {
                    "Version": "1",
                    "Statement": [
                        {
                            "Action": [
                                "ram:*"
                            ],
                            "Resource": [
                                "acs:ram:*:*:domain/*",
                                "acs:ram:*:*:application/*"
                            ],
                            "Effect": "Allow"
                        }
                    ]
                }
                ```

        **说明：** 创建好以上角色及策略后，即可正常开通及使用Flink全托管服务。

-   方式二

    如果您不小心删除了AliyunStreamAsiDefaultRole角色或者变更了授权策略导致Flink全托管服务不可用，您可以按照以下操作步骤先删除资源编排服务ROS的资源栈、RAM角色和RAM权限策略后，登录实时计算管理控制台，重新授权。

    1.  删除资源编排服务ROS的资源栈。
        1.  登录[ROS控制台](http://ros.console.aliyun.com)。
        2.  在左侧导航栏，单击**资源栈**。
        3.  在页面顶部，地域切换为**杭州**。
        4.  在**资源栈名称**后，分别输入FlinkServerlessStack和FlinkOnAckStack，并单击![搜索图标](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7833449951/p127081.png)图标

            **说明：**

            -   FlinkServerlessStack：Flink全托管的ROS资源栈统一名称。
            -   FlinkOnAckStack：容器服务ACK的ROS资源栈统一名称。
            。

        5.  在对应资源栈**操作**列中，单击**删除**，在弹出的对话框中，单击**确定**。
    2.  删除RAM角色。
        1.  登录RAM控制台。
            -   云账号登录[RAM控制台](https://ram.console.aliyun.com/)。
            -   RAM用户登录[RAM控制台](https://signin.aliyun.com/login.htm)。
        2.  在左侧导航栏，单击**RAM角色管理**。
        3.  在搜索栏中，输入AliyunStreamAsiDefaultRole。
        4.  在**操作**列中，单击**删除**，在弹出的对话框中，单击**确定**。

            **说明：** 您需要单击AliyunStreamAsiDefaultRole名称，进入角色详情页面，**移除权限**后，此角色才能删除成功。

    3.  删除RAM权限策略。
        1.  在RAM控制台左侧导航栏，选择**权限管理** \> **权限策略管理**。
        2.  在搜索栏中，分别输入AliyunStreamAsiDefaultRolePolicy0、AliyunStreamAsiDefaultRolePolicy1和FlinkServerlessPolicy。
        3.  在**操作**列中，单击**删除**，在弹出的对话框中，单击**确定**。
    4.  在实时计算管理控制台，重新授权。
        1.  登录[实时计算管理控制台](https://realtime-compute.console.aliyun.com/console/cell?spm=a2c4g.11186623.2.16.1a8023a9J8TiPV)。
        2.  单击**Flink全托管**下的**购买产品**。
        3.  在**授权请求**页面，单击**前往RAM进行授权**。

            ![前往授权](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7833449951/p110414.png)

        4.  在**云资源访问授权**页面，单击页面下方的**同意授权**。

            ![AliyunStreamAsiDefaultRole](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8833449951/p110415.png)


